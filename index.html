<!DOCTYPE html>
<html style="height: 100%;">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>Ranch Web Map</title>
	<link rel="icon" type="image/x-icon" href="assets/ranchlogo.png">

	<link rel="stylesheet" href="scripts/leaflet.css" />
	<script src="scripts/leaflet.js"></script>

	<script src="scripts/plugins/leaflet.edgebuffer.js"></script>
	<link rel="stylesheet" href="scripts/plugins/L.switchBasemap.css" />
	<script src="scripts/plugins/L.switchBasemap.js"></script>
</head>

<body style="height: 100%; margin: 0;">
	<div id="map" style="width:100%; height:100%;"></div><script type="text/javascript">

	function getCookie(name) {
		const cookies = document.cookie.split("; ").reduce((acc, cookie) => {
			const [key, value] = cookie.split("=");
			acc[key] = value;
			return acc;
		}, {});

		return cookies[name] ? decodeURIComponent(cookies[name]) : null;
	}

	function setCookie(key,value){
		if (key==null) {return;}

		const now = new Date();
		const d = new Date();
		d.setTime(d.getTime() + (45 * 24 * 60 * 60 * 1000));
		let expiry = "expires=" + d.toUTCString();

		document.cookie = key+"="+value+";"+expiry+";path=/";
	}

	if (getCookie("api_key") == null) {
		setCookie("api_key","https://google.com")
	} else if (getCookie("api_key") != null) {
		let value = getCookie("api_key")
		setCookie("api_key",value)
	}

	if (getCookie("last_layer") == null) {
		setCookie("last_layer","tan")
	} else if (getCookie("last_layer") != null) {
		let value = getCookie("last_layer")
		setCookie("last_layer",value)
	}

	var map = L.map('map').setView([55.5, -50], 0);

	const basemaps = [
		{
			id: 'tan',
			layer: L.tileLayer('map/tan/{z}/{x}_{y}.webp', {
				continuousWorld: false,
				noWrap: true,
				minZoom: 3,
				maxZoom: 7,
				edgeBufferTiles: 3
			}),
			icon: 'map/tan.png',
			name: 'Tan Map'
		},
		{
			id: 'gray',
			layer: L.tileLayer('map/gray/{z}/{x}_{y}.webp', {
				continuousWorld: false,
				noWrap: true,
				minZoom: 3,
				maxZoom: 7,
				edgeBufferTiles: 3
			}),
			icon: 'map/gray.png',
			name: 'Gray Map'
		},
		{
			id: 'black',
			layer: L.tileLayer('map/black/{z}/{x}_{y}.webp', {
				continuousWorld: false,
				noWrap: true,
				minZoom: 3,
				maxZoom: 7,
				edgeBufferTiles: 3
			}),
			icon: 'map/black.png',
			name: 'Black Map'
		}
	];

	const initial = basemaps.find(b => b.id === getCookie('last_layer')) || basemaps[0];

	initial.layer.addTo(map).bringToBack();
	L.basemapsSwitcher(basemaps, { position: 'topright' }).addTo(map);

	document.getElementById('map').style.backgroundImage = "url('map/"+getCookie('last_layer')+"/empty.webp')";

	map.on('basemapChange', function(e) {
		let layer = e.layer._url.split('map/')[1]?.split('/')[0];
		document.getElementById('map').style.backgroundImage = "url('map/"+layer+"/empty.webp')";

		if (e.layer._url.includes('/tan/')) {
			setCookie('last_layer', 'tan');
		} else if (e.layer._url.includes('/gray/')) {
			setCookie('last_layer', 'gray');
		} else if (e.layer._url.includes('/black/')) {
			setCookie('last_layer', 'black');
		}
	});

</script><style>
	.leaflet-control-zoom {opacity: 0;} /* disable me to re-enable zoom buttons */
	.leaflet-bar a {border-bottom: 0;}
	.leaflet-control-zoom-in {background-image: url('assets/icons/plus-circle.svg');}
	.leaflet-control-zoom-in span, .leaflet-control-zoom-out span {opacity: 0;}
	.leaflet-control-zoom-out {background-image: url('assets/icons/minus-circle.svg');}
	
	.basemapImg {background-image: url('assets/bg.png');}
	.name {opacity: 0;}
</style>
</body>
</html>